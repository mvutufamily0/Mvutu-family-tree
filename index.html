<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Famille MVUTU — Arbre & Profils</title>
  <style>
    :root{
      --bg:#0b0f19;
      --line:rgba(255,255,255,.12);
      --text:#eef2ff;
      --muted:#9aa4b2;
      --accent:#7c3aed;
      --green:#22c55e;
      --amber:#f59e0b;
      --red:#ef4444;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      background:
        radial-gradient(1000px 600px at 15% -10%, rgba(124,58,237,.26), transparent),
        radial-gradient(900px 600px at 90% 10%, rgba(34,197,94,.14), transparent),
        var(--bg);
      color:var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      line-height:1.35;
    }
    .wrap{max-width:1150px;margin:0 auto;padding:18px}
    header{
      position:sticky; top:0; z-index:10;
      backdrop-filter: blur(12px);
      background: linear-gradient(180deg, rgba(11,15,25,.85), rgba(11,15,25,.55));
      border-bottom:1px solid var(--line);
    }
    .top{
      display:flex; align-items:center; justify-content:space-between; gap:14px; flex-wrap:wrap;
      padding:14px 18px;
      max-width:1150px; margin:0 auto;
    }
    .brand{display:flex; align-items:flex-start; gap:12px;}
    .logo{
      width:38px; height:38px; border-radius:14px;
      background: radial-gradient(circle at 30% 30%, rgba(124,58,237,.95), rgba(124,58,237,.25));
      border:1px solid rgba(124,58,237,.35);
      box-shadow:0 18px 40px rgba(0,0,0,.25);
    }
    h1{margin:0;font-size:18px;letter-spacing:.2px}
    .sub{margin:4px 0 0;color:var(--muted);font-size:12.5px}

    .bar{display:flex; gap:10px; flex-wrap:wrap; align-items:center;}
    .btn{
      background:rgba(255,255,255,.06);
      border:1px solid var(--line);
      color:var(--text);
      padding:10px 12px;
      border-radius:14px;
      cursor:pointer;
      transition:.15s transform, .15s background;
      user-select:none;
      font-size:14px;
    }
    .btn:hover{background:rgba(255,255,255,.09)}
    .btn:active{transform:scale(.98)}
    .btn.primary{background:rgba(124,58,237,.18);border-color:rgba(124,58,237,.35);}
    .btn.danger{background:rgba(239,68,68,.14);border-color:rgba(239,68,68,.35);}

    input[type="search"], input[type="password"], textarea{
      background:rgba(255,255,255,.06);
      border:1px solid var(--line);
      color:var(--text);
      padding:12px 12px;
      border-radius:14px;
      outline:none;
      font-size:14px;
    }
    input[type="search"]{min-width:280px;flex:1 1 320px}
    textarea{width:100%;min-height:120px;resize:vertical}

    .grid{display:grid;gap:14px}
    .card{
      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border:1px solid var(--line);
      border-radius:22px;
      padding:16px;
      box-shadow: 0 18px 55px rgba(0,0,0,.25);
    }
    .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
    .muted{color:var(--muted)}
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding:6px 10px; border-radius:999px;
      background:rgba(124,58,237,.14);
      border:1px solid rgba(124,58,237,.28);
      font-size:12px; color:rgba(238,242,255,.95);
    }
    .tag{
      font-size:12px;
      padding:3px 8px;
      border-radius:999px;
      border:1px solid var(--line);
      color:rgba(238,242,255,.9);
      background:rgba(255,255,255,.04);
      display:inline-flex;
      align-items:center;
      gap:6px;
      white-space:nowrap;
    }
    .tag.spouse{border-color:rgba(34,197,94,.35); background:rgba(34,197,94,.12)}
    .tag.deceased{border-color:rgba(245,158,11,.35); background:rgba(245,158,11,.12)}
    .tag.parents{border-color:rgba(124,58,237,.35); background:rgba(124,58,237,.12)}
    .tag.child{border-color:rgba(255,255,255,.16)}
    .divider{height:1px;background:var(--line);margin:12px 0}

    .tree{
      margin-top:10px;
      padding:10px 10px 6px;
      background:rgba(0,0,0,.18);
      border:1px solid var(--line);
      border-radius:18px;
      overflow:auto;
    }
    ul{
      list-style:none;
      padding-left:22px;
      margin:6px 0;
      border-left:1px dashed rgba(255,255,255,.16);
    }
    li{position:relative;padding:6px 0 6px 12px}
    li::before{
      content:"";
      position:absolute; left:-1px; top:18px;
      width:12px; border-top:1px dashed rgba(255,255,255,.16);
    }
    details{border-radius:14px;padding:4px 6px}
    summary{
      list-style:none;
      cursor:pointer;
      display:flex;
      align-items:center;
      gap:10px;
      padding:6px 8px;
      border-radius:14px;
      transition: background .15s;
    }
    summary::-webkit-details-marker{display:none}
    summary:hover{background:rgba(255,255,255,.05)}
    .node{display:flex;align-items:center;gap:10px;flex-wrap:wrap}
    .name{font-weight:650;letter-spacing:.2px}
    .count{color:rgba(154,164,178,.9);font-size:12px;margin-left:auto}
    mark{background:rgba(124,58,237,.28);color:var(--text);padding:0 3px;border-radius:5px}

    .kpi{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:10px}
    .kpi .mini{padding:12px;border-radius:18px;border:1px solid var(--line);background:rgba(255,255,255,.04)}
    .mini .big{font-size:18px;font-weight:750;margin:0}
    .mini .small{margin:4px 0 0;color:var(--muted);font-size:12px}

    .profile{display:grid;gap:14px;grid-template-columns:320px 1fr;}
    @media (max-width: 920px){ .profile{grid-template-columns:1fr} .kpi{grid-template-columns:1fr} }

    .avatar{
      width:100%; aspect-ratio: 4/3;
      border-radius:22px;
      border:1px solid var(--line);
      background: radial-gradient(circle at 30% 30%, rgba(124,58,237,.26), transparent), rgba(255,255,255,.03);
      display:flex; align-items:center; justify-content:center;
      color:rgba(154,164,178,.9);
      text-align:center;
      padding:14px;
    }
    .links{display:flex;gap:10px;flex-wrap:wrap}
    .smallnote{font-size:12px;color:rgba(154,164,178,.9)}

    .lockscreen{min-height:100dvh;display:flex;align-items:center;justify-content:center;padding:18px;}
    .lockcard{
      width:min(520px, 100%);
      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border:1px solid var(--line);
      border-radius:26px;
      padding:18px;
      box-shadow:0 18px 60px rgba(0,0,0,.35);
    }
    .error{color:#fecaca}
    .success{color:#bbf7d0}

    /* MOBILE-FIRST UPGRADES */
    @media (max-width: 560px){
      #subtitleTxt { display:none; }
      #langBtn, #expandAll, #collapseAll, #lockBtn { display:none; }
      input[type="search"]{ min-width:0; width:100%; flex:1 1 auto; }
      summary{ padding: 12px 10px; }
      .btn{ padding: 12px 12px; border-radius: 16px; }
      ul{ padding-left: 14px; }
      li{ padding-left: 8px; }
      li::before{ width: 8px; }
      .tree{ padding: 8px; }
      .node{ gap: 8px; }
      .tag.spouse{ width: 100%; justify-content:flex-start; white-space:normal; }
      .count{ margin-left: 0; width:100%; }
      main.wrap{ padding-bottom: 86px; }
    }

    /* Bottom nav */
    .bottomnav{
      position:fixed; left:0; right:0; bottom:0;
      padding:10px 12px;
      display:none;
      gap:10px;
      justify-content:space-around;
      background:rgba(11,15,25,.92);
      border-top:1px solid rgba(255,255,255,.12);
      backdrop-filter: blur(12px);
      z-index:30;
    }
    @media (max-width: 560px){ .bottomnav{ display:flex; } }

    /* More sheet */
    .sheetOverlay{
      position:fixed; inset:0;
      background:rgba(0,0,0,.55);
      display:none;
      align-items:flex-end;
      justify-content:center;
      z-index:40;
    }
    .sheet{
      width:min(680px,100%);
      border-top-left-radius:24px;
      border-top-right-radius:24px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(17,24,41,.95);
      backdrop-filter: blur(14px);
      padding:14px;
      box-shadow: 0 -20px 60px rgba(0,0,0,.45);
    }
    .sheet h3{margin:4px 0 10px;font-size:14px}
    .sheet .row{justify-content:space-between}
  </style>
</head>
<body>

<header id="appHeader" style="display:none;">
  <div class="top">
    <div class="brand">
      <div class="logo"></div>
      <div>
        <h1 id="titleTxt">Famille MVUTU — Arbre & Profils</h1>
        <div class="sub" id="subtitleTxt">Recherche, branches, et fiches individuelles.</div>
      </div>
    </div>

    <div class="bar">
      <input id="search" type="search" placeholder="Rechercher un nom…" />
      <button class="btn" id="navTree">Arbre</button>
      <button class="btn" id="navDirectory">Annuaire</button>

      <button class="btn" id="langBtn">FR</button>
      <button class="btn" id="expandAll">Tout déplier</button>
      <button class="btn" id="collapseAll">Tout replier</button>
      <button class="btn danger" id="lockBtn">Verrouiller</button>
    </div>
  </div>
</header>

<section class="lockscreen" id="lockScreen">
  <div class="lockcard">
    <div class="row" style="justify-content:space-between;">
      <div>
        <h1 style="font-size:20px;margin:0;">Private access</h1>
        <p class="sub" style="margin:6px 0 0;">Enter the password to view the family tree.</p>
      </div>
      <span class="pill">V2 Mobile</span>
    </div>

    <div class="divider"></div>

    <div class="grid">
      <label class="muted" for="pass">Password</label>
      <input id="pass" type="password" placeholder="••••••••" />
      <button class="btn primary" id="unlockBtn">Unlock</button>
      <div class="smallnote" id="lockHint"></div>
      <div id="lockMsg" class="error"></div>
    </div>
  </div>
</section>

<main class="wrap" id="app" style="display:none;">
  <section class="card">
    <div class="row" style="justify-content:space-between;">
      <div>
        <div class="row" style="gap:10px;">
          <h2 style="margin:0;font-size:16px;" id="sectionTitle">Arbre</h2>
          <span class="pill" id="statusPill">Privé</span>
        </div>
        <p class="muted" style="margin:8px 0 0;" id="sectionDesc"></p>
      </div>
    </div>

    <div class="divider"></div>
    <div class="kpi" id="kpis"></div>
    <div class="divider"></div>

    <div id="view"></div>
  </section>
</main>

<nav class="bottomnav" id="bottomNav" aria-label="Bottom navigation">
  <button class="btn primary" id="bnTree">Tree</button>
  <button class="btn" id="bnDir">Directory</button>
  <button class="btn" id="bnSearch">Search</button>
  <button class="btn" id="bnMore">More</button>
</nav>

<div class="sheetOverlay" id="sheetOverlay" role="dialog" aria-modal="true">
  <div class="sheet">
    <div class="row">
      <h3 style="margin:0;">More</h3>
      <button class="btn" id="sheetClose">Close</button>
    </div>
    <div class="divider"></div>
    <div class="grid" style="gap:10px;">
      <button class="btn" id="mLang">Language</button>
      <div class="row" style="gap:10px;">
        <button class="btn" id="mExpand">Expand all</button>
        <button class="btn" id="mCollapse">Collapse all</button>
      </div>
      <button class="btn danger" id="mLock">Lock</button>
      <div class="smallnote">Tip: for real privacy, use Firebase login (V3).</div>
    </div>
  </div>
</div>

<script>
/* CONFIG */
const CONFIG = {
  PASSWORD: "MVUTU2026",
  BRAND_TITLE_FR: "Famille MVUTU — Arbre & Profils",
  BRAND_TITLE_EN: "MVUTU Family — Tree & Profiles",
};

/* DATA */
const rawTree = {
  name: "Marcel MVUTU Kuetutinina",
  deceased: false,
  spouse: { name: "Thérèse Bafundila MAYANGI", deceased: false },
  parents: [{ name: "BAKITANGA" }, { name: "MELE" }],
  siblings: [
    { relation: "Jeune frère", name: "Grégoire SAKUBA" },
    { relation: "Grande-sœur", name: "Ma SEMI" },
  ],
  children: [
    { label:"A", name:"Florence VUVU MIATUATAMBUDILA MVUTU", spouse:{name:"Seraphin MATEZA"}, children:[
      { name:"Arsène", deceased:true },
      { name:"Noranìe MATEZA", spouse:{name:"Raphaël Mpanu Mpanu Bibanda"}, children:[
        { name:"Jéhovah rapha MATEZA" }, { name:"Éminence Mpanu" }, { name:"Orgi Vuvu" }
      ]},
      { name:"Derrick MATEZA" },
      { name:"Diazuna Mateza Keren", spouse:{name:"Dieudonné Nzila Zengamambu"} },
      { name:"Tychique MATEZA" },
      { name:"Ben Éloge MATEZA" }
    ]},
    { label:"B", name:"Florian Prudhomme BAKITANGA MVUTU", spouse:{name:"Vicky MAMBOTE"}, children:[
      { name:"Bueso NSAYI (JOY) MVUTU", spouse:{name:"Cedrick BALISENT"} },
      { name:"Gedeon MVUTU" },
      { name:"David MVUTU", spouse:{name:"Dorcas NZAI BOKIE"} },
      { name:"Florence MAMBOTE MVUTU" }
    ]},
    { label:"C", name:"Placide MAKOLAVUMA MVUTU", spouse:{name:"Bahanungu Ami MANDUKI"}, children:[
      { name:"Abraham Lincoln Kuetutinina MVUTU" },
      { name:"William Ami Elijah MVUTU" },
      { name:"Salem Manduki MVUTU" }
    ]},
    { label:"D", name:"Eddie-le-jour NZINGULA", spouse:{name:"Samuel NDEBO", deceased:true}, children:[
      { name:"Magloire Bebiki NDEBO", spouse:{name:"Olivier Maluku Mbomba"}, children:[
        { name:"Moïse Maluku Mbomba" }, { name:"Samuel Maluku Mbomba" }
      ]},
      { name:"Corneille NDEBO" },
      { name:"Abigaël BAFUNDILA NDEBO" }
    ]},
    { label:"E", name:"Flavien Mayangi", spouse:{name:"Annie MBAYABU ILUNGA"}, children:[
      { name:"Emmanuel BAKITANGA MVUTU" },
      { name:"Joseph ILUNGA MVUTU" },
      { name:"Anna BAFUNDILA MVUTU" },
      { name:"Elijah Tutinina Mu Yesu Klisto MVUTU" }
    ]},
    { label:"F", name:"Mireille BASOLUKA MVUTU", spouse:{name:"PÉPÉ BANZA"}, children:[
      { name:"Grâce Nehema Banza" },
      { name:"Divine Basoluka Banza" },
      { name:"Sifa Kalume Banza" },
      { name:"Peace Amani Banza" }
    ]},
    { label:"G", name:"EYO Josué MVUTU", deceased:true, spouse:{name:"Nadia MABANZA"}, children:[
      { name:"Manassé-Winner MAYANGI MA MVUTU" },
      { name:"Amélia HOPE MVUTU" },
      { name:"Michael MVUTU" },
      { name:"Gabriel Branson MVUTU" }
    ]},
    { label:"H", name:"Nsayi Bueso Sylvie", deceased:true },
    { label:"I", name:"Gênérose BAKUNDIKA MVUTU" }
  ]
};

/* i18n */
const I18N = {
  fr: { tree:"Arbre", directory:"Annuaire", private:"Privé", clickHint:"Clique sur un nom pour déplier/replier. Utilise la recherche pour filtrer.",
        people:"Personnes", branches:"Branches", deceased:"Décédés (†)", patriarch:"Patriarche", spouse:"époux/épouse", parents:"Parents", siblings:"Fratrie", children:"Enfants",
        openProfile:"Ouvrir la fiche", notFound:"Aucun résultat.", more:"Plus", close:"Fermer", expandAll:"Tout déplier", collapseAll:"Tout replier", lock:"Verrouiller",
        searchPh:"Rechercher un nom…" },
  en: { tree:"Tree", directory:"Directory", private:"Private", clickHint:"Tap a name to expand/collapse. Use search to filter.",
        people:"People", branches:"Branches", deceased:"Deceased (†)", patriarch:"Patriarch", spouse:"spouse", parents:"Parents", siblings:"Siblings", children:"Children",
        openProfile:"Open profile", notFound:"No results.", more:"More", close:"Close", expandAll:"Expand all", collapseAll:"Collapse all", lock:"Lock",
        searchPh:"Search a name…" }
};

const $ = (s)=>document.querySelector(s);
function escapeHtml(str=""){ return str.replace(/[&<>"']/g,m=>({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;" }[m])); }
function highlight(text,q){
  if(!q) return escapeHtml(text);
  const t=text||"", i=t.toLowerCase().indexOf(q.toLowerCase());
  if(i===-1) return escapeHtml(t);
  return `${escapeHtml(t.slice(0,i))}<mark>${escapeHtml(t.slice(i,i+q.length))}</mark>${escapeHtml(t.slice(i+q.length))}`;
}

/* auth */
const AUTH_KEY="mvutu_unlocked_v2";
const isUnlocked=()=>localStorage.getItem(AUTH_KEY)==="1";
const unlock=()=>localStorage.setItem(AUTH_KEY,"1");
const lock=()=>localStorage.removeItem(AUTH_KEY);

/* state */
let lang=(localStorage.getItem("mvutu_lang")||"fr");
const t=()=>I18N[lang];
const setLang=(next)=>{ lang=next; localStorage.setItem("mvutu_lang",lang); renderShell(); route(); };

/* sheet */
function openSheet(){ $("#sheetOverlay").style.display="flex"; }
function closeSheet(){ $("#sheetOverlay").style.display="none"; }

/* stats */
function stats(){
  const people=[];
  function walk(n){ people.push(n); (n.children||[]).forEach(walk); }
  rawTree.children.forEach(walk);
  const total = people.length + 1; // + Marcel
  const deceased = (rawTree.deceased?1:0) + people.filter(p=>p.deceased).length;
  const branches = rawTree.children.length;
  return {total,deceased,branches};
}

/* tree render */
function setAllDetails(open){ document.querySelectorAll("details").forEach(d=>d.open=open); }
function subtreeHasMatch(node,q){
  if(!q) return true;
  const target=[node.name||"", node.spouse?.name||""].join(" ").toLowerCase();
  if(target.includes(q.toLowerCase())) return true;
  return (node.children||[]).some(c=>subtreeHasMatch(c,q));
}
function renderNode(node, query){
  const li=document.createElement("li");
  if(query && !subtreeHasMatch(node,query)){ li.style.display="none"; return li; }
  const hasKids=(node.children||[]).length>0;
  const deceasedBadge=node.deceased?`<span class="tag deceased">†</span>`:"";
  const spouseBadge=node.spouse?.name?`<span class="tag spouse">${t().spouse}: ${escapeHtml(node.spouse.name)}${node.spouse.deceased?" †":""}</span>`:"";

  if(hasKids){
    const d=document.createElement("details");
    if(query) d.open=true;
    const s=document.createElement("summary");
    s.innerHTML=`
      <span class="node">
        <span class="name">${highlight(node.name,query)}</span>
        ${deceasedBadge}
        ${spouseBadge}
        <span class="count">${node.children.length} ${t().children.toLowerCase()}</span>
      </span>
    `;
    const ul=document.createElement("ul");
    node.children.forEach(ch=>ul.appendChild(renderNode(ch,query)));
    d.appendChild(s); d.appendChild(ul);
    li.appendChild(d);
  } else {
    li.innerHTML=`
      <div class="node">
        <span class="name">${highlight(node.name,query)}</span>
        ${deceasedBadge}
        ${spouseBadge}
      </div>
    `;
  }
  return li;
}

function renderTreeView(query){
  $("#sectionTitle").textContent=t().tree;
  $("#sectionDesc").textContent=t().clickHint;
  const view=$("#view");
  view.innerHTML=`
    <div class="row" style="justify-content:space-between;align-items:flex-start;">
      <div>
        <div class="tag parents">${t().patriarch}: ${escapeHtml(rawTree.name)}${rawTree.deceased?" †":""}</div>
        <div class="row" style="margin-top:10px;gap:8px;flex-wrap:wrap;">
          ${rawTree.spouse?.name?`<span class="tag spouse">${t().spouse}: ${escapeHtml(rawTree.spouse.name)}${rawTree.spouse.deceased?" †":""}</span>`:""}
          ${rawTree.parents?.length?`<span class="tag parents">${t().parents}: ${rawTree.parents.map(p=>escapeHtml(p.name)).join(" & ")}</span>`:""}
          ${rawTree.siblings?.length?`<span class="tag">${t().siblings}: ${rawTree.siblings.map(s=>escapeHtml(s.relation+" — "+s.name)).join(" • ")}</span>`:""}
        </div>
      </div>
    </div>
    <div class="tree" id="treeBox"></div>
  `;
  const ul=document.createElement("ul");
  rawTree.children.forEach(ch=>ul.appendChild(renderNode(ch,query)));
  $("#treeBox").appendChild(ul);
}

/* directory (simple list) */
function flatten(){
  const out=[{name:rawTree.name,deceased:rawTree.deceased,spouse:rawTree.spouse,label:"P"}];
  function walk(n,label){
    out.push({name:n.name,deceased:!!n.deceased,spouse:n.spouse||null,label});
    (n.children||[]).forEach(ch=>walk(ch,label));
  }
  rawTree.children.forEach(ch=>walk(ch,ch.label||"?"));
  return out;
}
function renderDirectory(query){
  $("#sectionTitle").textContent=t().directory;
  $("#sectionDesc").textContent=t().clickHint;
  const view=$("#view");
  const q=(query||"").trim().toLowerCase();
  const list=flatten().sort((a,b)=>a.name.localeCompare(b.name));
  const filtered=q?list.filter(p=>[p.name,p.spouse?.name,p.label].filter(Boolean).join(" ").toLowerCase().includes(q)):list;
  if(!filtered.length){ view.innerHTML=`<div class="muted">${t().notFound}</div>`; return; }
  view.innerHTML=`
    <div class="grid" style="gap:10px;">
      ${filtered.map(p=>`
        <div class="card" style="padding:14px;">
          <div class="row" style="justify-content:space-between;align-items:flex-start;">
            <div>
              <div class="row" style="gap:8px;">
                <div class="name">${escapeHtml(p.name)} ${p.deceased?`<span class="tag deceased">†</span>`:""}</div>
                ${p.label && p.label!=="P"?`<span class="tag">Branch ${escapeHtml(p.label)}</span>`:`<span class="tag parents">${t().patriarch}</span>`}
              </div>
              <div class="row" style="margin-top:8px;gap:8px;flex-wrap:wrap;">
                ${p.spouse?.name?`<span class="tag spouse">${t().spouse}: ${escapeHtml(p.spouse.name)}${p.spouse.deceased?" †":""}</span>`:""}
              </div>
            </div>
          </div>
        </div>
      `).join("")}
    </div>
  `;
}

/* routing */
function go(hash){ location.hash=hash; }
function currentHash(){ return location.hash || "#tree"; }
function route(){
  const q=($("#search").value||"").trim();
  if(currentHash()==="#dir") renderDirectory(q);
  else renderTreeView(q);
}

/* shell */
function renderShell(){
  $("#titleTxt").textContent = (lang==="fr"?CONFIG.BRAND_TITLE_FR:CONFIG.BRAND_TITLE_EN);
  $("#subtitleTxt").textContent = (lang==="fr"?"Recherche, branches, et fiches individuelles.":"Search, branches, and individual profiles.");
  $("#navTree").textContent=t().tree;
  $("#navDirectory").textContent=t().directory;
  $("#statusPill").textContent=t().private;
  $("#search").placeholder=t().searchPh;

  $("#bnTree").textContent=t().tree;
  $("#bnDir").textContent=t().directory;
  $("#bnMore").textContent=t().more;
  $("#sheetClose").textContent=t().close;
  $("#mExpand").textContent=t().expandAll;
  $("#mCollapse").textContent=t().collapseAll;
  $("#mLock").textContent=t().lock;

  const s=stats();
  $("#kpis").innerHTML=`
    <div class="mini"><p class="big">${s.total}</p><p class="small">${t().people}</p></div>
    <div class="mini"><p class="big">${s.branches}</p><p class="small">${t().branches}</p></div>
    <div class="mini"><p class="big">${s.deceased}</p><p class="small">${t().deceased}</p></div>
  `;
}

/* init */
function initApp(){
  if(!isUnlocked()){
    $("#lockScreen").style.display="flex";
    $("#appHeader").style.display="none";
    $("#app").style.display="none";
    $("#lockHint").textContent = `Current password: ${CONFIG.PASSWORD}`;
    return;
  }
  $("#lockScreen").style.display="flex"; // keeps layout stable briefly
  $("#lockScreen").style.display="none";
  $("#appHeader").style.display="block";
  $("#app").style.display="block";
  renderShell();
  route();
}

/* events */
window.addEventListener("hashchange", route);
$("#search").addEventListener("input", route);

$("#unlockBtn").addEventListener("click", ()=>{
  const val=($("#pass").value||"").trim();
  if(val===CONFIG.PASSWORD){ unlock(); $("#lockMsg").textContent=""; initApp(); if(!location.hash) location.hash="#tree"; }
  else $("#lockMsg").textContent="Incorrect password.";
});
$("#pass").addEventListener("keydown",(e)=>{ if(e.key==="Enter") $("#unlockBtn").click(); });

$("#navTree").addEventListener("click",()=>go("#tree"));
$("#navDirectory").addEventListener("click",()=>go("#dir"));
$("#langBtn").addEventListener("click",()=>setLang(lang==="fr"?"en":"fr"));
$("#expandAll").addEventListener("click",()=>setAllDetails(true));
$("#collapseAll").addEventListener("click",()=>setAllDetails(false));
$("#lockBtn").addEventListener("click",()=>{ lock(); location.hash="#tree"; initApp(); });

$("#bnTree").addEventListener("click",()=>go("#tree"));
$("#bnDir").addEventListener("click",()=>go("#dir"));
$("#bnSearch").addEventListener("click",()=>$("#search").focus());
$("#bnMore").addEventListener("click",openSheet);

$("#sheetClose").addEventListener("click",closeSheet);
$("#sheetOverlay").addEventListener("click",(e)=>{ if(e.target.id==="sheetOverlay") closeSheet(); });
$("#mLang").addEventListener("click",()=>{ setLang(lang==="fr"?"en":"fr"); closeSheet(); });
$("#mExpand").addEventListener("click",()=>{ setAllDetails(true); closeSheet(); });
$("#mCollapse").addEventListener("click",()=>{ setAllDetails(false); closeSheet(); });
$("#mLock").addEventListener("click",()=>{ lock(); closeSheet(); location.hash="#tree"; initApp(); });

initApp();
</script>

</body>
</html>
